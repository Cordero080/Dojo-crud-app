<!-- views/forms/show.ejs -->
<!-- Purpose: Show a single form with safe rendering + Prev/Next arrows between forms -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/head') %>
  </head>
  <body class="page-show">
    <%- include('../partials/nav') %>

    <% /* ---------- Safe helpers so missing values don't explode ---------- */ %>
    <%
      var f = form || {};

      function safe(v) {
        return (v === undefined || v === null || v === '') ? '-' : v;
      }
      function safeRankType(rt) {
        rt = (rt || '').toString();
        return rt ? rt.toUpperCase() : '-';
      }
      function safeNum(n) {
        var x = Number(n);
        return Number.isFinite(x) ? x : '-';
      }
      function safeDateTime(d) {
        try {
          if (!d) return '-';
          var dt = new Date(d);
          return isNaN(dt.getTime()) ? '-' : dt.toLocaleString();
        } catch (_) {
          return '-';
        }
      }
    %>

    <% /* ---------- Prev/Next arrows (render only if route provided IDs) ----------
       - These use your existing .nav-arrow .nav-prev/.nav-next CSS
       - The route should set prevId/nextId (same ordering logic as edit route)
    --------------------------------------------------------------------------- */ %>
    <% if (typeof prevId !== 'undefined' && prevId) { %>
      <a class="nav-arrow nav-prev"
         href="/forms/<%= prevId %>"
         aria-label="Previous form"
         title="Previous form">&lsaquo;</a>
    <% } %>
    <% if (typeof nextId !== 'undefined' && nextId) { %>
      <a class="nav-arrow nav-next"
         href="/forms/<%= nextId %>"
         aria-label="Next form"
         title="Next form">&rsaquo;</a>
    <% } %>

    <h1 style="text-align:center;"><%= safe(title || f.name || 'Form') %></h1>

    <table class="table">
      <tbody class="show-top">
        <tr>
          <th>Name</th>
          <td><%= safe(f.name) %></td>
        </tr>
        <tr>
          <th>Rank</th>
          <td><%= safeRankType(f.rankType) %> <%= safeNum(f.rankNumber) %></td>
        </tr>
        <tr>
          <th>Belt</th>
          <td><%= safe(f.beltColor) %></td>
        </tr>
        <tr>
          <th>Category</th>
          <td><%= safe(f.category) %></td>
        </tr>
        <tr>
          <th>Learned</th>
          <td><%= f.learned ? 'Yes' : 'No' %></td>
        </tr>
        <tr>
          <td colspan="2">
            <div style="font-weight: bold; margin-bottom: 4px;">DESCRIPTION</div>
            <div class="description-block"><%= safe(f.description) %></div>
          </td>
        </tr>
        <tr class="meta-row">
          <th>Reference</th>
          <td>
            <% if (f.referenceUrl) { %>
              <a href="<%= f.referenceUrl %>" target="_blank" rel="noopener">Open link</a>
            <% } else { %>
              -
            <% } %>
          </td>
        </tr>
        <tr class="meta-row">
          <th>Created</th>
          <td><%= safeDateTime(f.createdAt) %></td>
        </tr>
        <tr class="meta-row">
          <th>Updated</th>
          <td><%= safeDateTime(f.updatedAt) %></td>
        </tr>
      </tbody>
    </table>

    <% /* Keep your Edit link exactly as requested */ %>
    <% if (f && f._id) { %>
      <p style="margin-top: 20px; margin-bottom: -20px; text-align: left;">
        <a href="/forms/<%= f._id %>/edit" class="show-edit-link"> EDIT</a>
      </p>
    <% } %>

    <% if (f && f._id) { %>
      <div class="delete-center">
        <div class="delete-center--higher">
          <form action="/forms/<%= f._id %>?_method=DELETE" method="POST">
            <button class="delete-button-show" type="submit"
                    onclick="return confirm('Soft delete this form?')">
              Delete
            </button>
          </form>
        </div>
      </div>
    <% } %>

    <div style="position: fixed; bottom: 20px; left: 1.5rem; width: auto; z-index: 100;">
      <%- include('../partials/footer') %>
    </div>
  </body>
</html>
